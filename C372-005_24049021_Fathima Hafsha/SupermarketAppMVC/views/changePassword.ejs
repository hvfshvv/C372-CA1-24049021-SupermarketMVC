<%- include("partials/header"); %>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="col-md-6 mx-auto mt-4">

    <h2 class="fw-bold mb-4 text-center">Change Password</h2>

    <!-- Flash messages stored in hidden divs -->
    <% if (messages && messages.success && messages.success.length > 0) { %>
        <div id="swal-success" data-msg="<%= messages.success[0] %>"></div>
    <% } %>

    <% if (messages && messages.error && messages.error.length > 0) { %>
        <div id="swal-error" data-msg="<%= messages.error[0] %>"></div>
    <% } %>

    <form action="/profile/change-password" method="POST" class="card p-4 shadow-sm">

        <div class="mb-3">
            <label class="form-label fw-semibold">Current Password</label>
            <input type="password" name="currentPassword" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">New Password</label>
            <input type="password" id="newPassword" name="newPassword" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label fw-semibold">Confirm New Password</label>
            <input type="password" id="confirmPassword" name="confirmPassword"
                   class="form-control" required>
        </div>

        <div id="pwError" class="text-danger mb-2" style="display:none;">
            Passwords do not match
        </div>

        <button class="btn btn-primary w-100 fw-bold">Update Password</button>

    </form>

</div>

<script>
    // Live password match validation
    const newPw = document.getElementById("newPassword");
    const confirmPw = document.getElementById("confirmPassword");
    const pwError = document.getElementById("pwError");

    confirmPw.addEventListener("input", () => {
        pwError.style.display = newPw.value !== confirmPw.value ? "block" : "none";
    });

    // SweetAlert popups
    const successDiv = document.getElementById("swal-success");
    const errorDiv = document.getElementById("swal-error");

    if (successDiv) {
        Swal.fire({
            icon: "success",
            title: "Success",
            text: successDiv.dataset.msg,
            confirmButtonColor: "#198754"
        });
    }

    if (errorDiv) {
        Swal.fire({
            icon: "error",
            title: "Error",
            text: errorDiv.dataset.msg,
            confirmButtonColor: "#d9534f"
        });
    }
</script>

<%- include("partials/footer"); %>
