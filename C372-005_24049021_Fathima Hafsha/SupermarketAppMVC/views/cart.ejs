<%- include("partials/header"); %>

<h2 class="fw-bold mb-4">Your Cart</h2>

<!-- Flash Messages (handled globally through header) -->

<% if (cart.length === 0) { %>

    <div class="alert alert-info text-center">
        Your cart is empty!
        <br><br>
        <a href="/shopping" class="btn btn-primary">Continue Shopping</a>
    </div>

<% } else { %>


    <% let total = 0; %>

    <div class="row">
        <% cart.forEach(item => { 
            const lineTotal = Number(item.price) * item.quantity;
            total += lineTotal;
        %>
            <div class="col-md-4 mb-4">
                <div class="card shadow-sm h-100">

                    <img src="/images/<%= item.image %>" 
                         class="card-img-top"
                         style="height: 200px; object-fit: cover;">

                    <div class="card-body">
                        <h5 class="card-title fw-bold">
                            <%= item.productName %>
                        </h5>

                        <!-- UPDATE QUANTITY -->
                        <form action="/cart/update/<%= item.cart_id %>" method="POST" class="d-flex mb-3">
                            <input 
                                type="number"
                                name="quantity"
                                min="1"
                                value="<%= item.quantity %>"
                                class="form-control me-2"
                            >
                            <button class="btn btn-warning fw-bold">Update</button>
                        </form>

                        <p class="card-text mb-2">
                            <strong>Price:</strong> $<%= Number(item.price).toFixed(2) %><br>
                            <strong>Line Total:</strong> $<%= lineTotal.toFixed(2) %>
                        </p>

                        <!-- REMOVE ITEM -->
                        <form action="/cart/delete/<%= item.cart_id %>" method="POST">
                            <button class="btn btn-danger w-100">Remove</button>
                        </form>
                    </div>

                </div>
            </div>
        <% }) %>
    </div>

    <div class="d-flex justify-content-between mt-4">

        <a href="/shopping" class="btn btn-secondary btn-lg fw-bold">
            Continue Shopping
        </a>

        <div class="text-end">
            <h4 class="fw-bold mb-3">
                Total: $<%= total.toFixed(2) %>
            </h4>

            <a href="/checkout" class="btn btn-success btn-lg fw-bold">
                Proceed to Checkout
            </a>
        </div>

    </div>

<% } %>

<%- include("partials/footer"); %>
