<%- include("partials/header"); %>

<div class="container mt-4 mb-5" style="max-width: 700px;">

    <h2 class="fw-bold mb-4 text-center">Checkout</h2>

    <div class="card p-4 shadow-sm">

        <h4 class="mb-3 fw-bold">Order Summary</h4>

        <% cart.forEach(item => { %>
            <div class="d-flex justify-content-between border-bottom py-2">
                <div>
                    <strong><%= item.productName %></strong><br>
                    Quantity: <%= item.quantity %>
                </div>
                <div>
                    $<%= (item.price * item.quantity).toFixed(2) %>
                </div>
            </div>
        <% }); %>

        <div class="d-flex justify-content-between mt-3">
            <h4>Total:</h4>
            <h4 class="fw-bold">$<%= total.toFixed(2) %></h4>
        </div>

        <!-- Checkout Form -->
        <form id="checkoutForm" action="/checkout/confirm" method="POST" class="mt-4 text-center">

            <!-- Confirm Button -->
            <button id="confirmBtn" class="btn btn-success w-100 btn-lg fw-bold">
                Confirm Payment
            </button>

            <!-- Spinner (hidden until button clicked) -->
            <div id="checkoutSpinner" class="mt-3 d-none">
                <div class="spinner-border text-success" role="status"></div>
                <p class="mt-2 fw-bold text-success">Processing your order...</p>
            </div>

        </form>

    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('checkoutForm');
        const btn = document.getElementById('confirmBtn');
        const spinner = document.getElementById('checkoutSpinner');

        if (form && btn && spinner) {
            form.addEventListener('submit', function () {
                btn.disabled = true;
                btn.innerText = "Processing...";
                spinner.classList.remove('d-none');
            });
        }
    });
</script>

<%- include("partials/footer"); %>
