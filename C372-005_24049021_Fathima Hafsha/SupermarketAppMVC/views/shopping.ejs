<%- include("partials/header"); %>

<!-- SAFE PATCH -->
<% const searchValue = typeof locals.search !== "undefined" ? locals.search : ""; %>
<% const categoryValue = typeof locals.category !== "undefined" ? locals.category : ""; %>

<h2 class="fw-bold mb-4">Supermarket Products</h2>

<form method="GET" action="/shop" class="d-flex align-items-center gap-3 mb-4">

    <input 
        type="text"
        name="search"
        class="form-control"
        placeholder="Search products..."
        style="max-width: 300px;"
        value="<%= searchValue %>"
    >

    <select 
        name="category"
        class="form-select"
        style="max-width: 200px;"
    >
        <option value="">All Categories</option>
        <option value="Fruits"     <%= categoryValue === "Fruits" ? "selected" : "" %>>Fruits</option>
        <option value="Vegetables" <%= categoryValue === "Vegetables" ? "selected" : "" %>>Vegetables</option>
        <option value="Dairy"      <%= categoryValue === "Dairy" ? "selected" : "" %>>Dairy</option>
        <option value="Bakery"     <%= categoryValue === "Bakery" ? "selected" : "" %>>Bakery</option>
        <option value="Beverages"  <%= categoryValue === "Beverages" ? "selected" : "" %>>Beverages</option>
        <option value="Snacks"     <%= categoryValue === "Snacks" ? "selected" : "" %>>Snacks</option>
        <option value="Other"      <%= categoryValue === "Other" ? "selected" : "" %>>Other</option>
    </select>

    <button class="btn btn-primary">Apply</button>
</form>

<div class="product-container">

    <% products.forEach(p => { %>

        <div class="product-card">

            <img src="/images/<%= p.image %>" alt="Product Image">

            <h5 class="fw-bold mt-2 mb-1"><%= p.productName %></h5>

            <p class="small text-secondary mb-1">
                <strong>Category:</strong> <%= p.category %>
            </p>

            <p class="text-muted mb-2">
                <strong>Price:</strong> $<%= p.price.toFixed(2) %><br>
                    <strong>Stock:</strong>
                    <% if (p.lowStock) { %>
                        <span class="text-danger">Low Stock! (<%= p.quantity %> left)</span>
                        <% } else { %>
                            <%= p.quantity %>
                                <% } %>
            
            </p>

            <a href="/product/<%= p.id %>" class="btn btn-view w-100 mb-2">View Details</a>

            <form action="/add-to-cart/<%= p.id %>" method="POST">
                <button class="btn btn-add w-100">Add to Cart</button>
            </form>

        </div>

    <% }) %>

</div>

<%- include("partials/footer"); %>
